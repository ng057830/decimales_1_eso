<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mundo Decimal - 1¬∫ ESO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap');
        
        body {
            font-family: 'Outfit', sans-serif;
            background-color: #f0f4f8;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .decimal-place {
            transition: all 0.3s ease;
        }

        .decimal-place:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .card-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .feedback-pop {
            animation: pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes pop {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-5xl mx-auto">
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-4xl font-extrabold text-indigo-800 mb-2">Mundo Decimal</h1>
            <p class="text-gray-600">Domina los n√∫meros decimales para 1¬∫ de la ESO</p>
            <div class="mt-4 flex justify-center items-center gap-6 bg-white p-4 rounded-2xl shadow-sm inline-flex">
                <div class="text-center">
                    <span class="block text-xs uppercase font-bold text-gray-400">Puntos</span>
                    <span id="score" class="text-2xl font-bold text-indigo-600">0</span>
                </div>
                <div class="h-10 w-px bg-gray-200"></div>
                <div class="text-center">
                    <span class="block text-xs uppercase font-bold text-gray-400">Nivel</span>
                    <span id="level-name" class="text-2xl font-bold text-indigo-600">Aprendiz</span>
                </div>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="flex flex-wrap justify-center gap-2 mb-8">
            <button onclick="showTab('posicion')" class="tab-btn px-4 py-2 bg-indigo-600 text-white rounded-lg font-semibold shadow-md active-tab">1. Valor de Posici√≥n</button>
            <button onclick="showTab('orden')" class="tab-btn px-4 py-2 bg-white text-indigo-600 rounded-lg font-semibold shadow-md hover:bg-indigo-50">2. Comparaci√≥n</button>
            <button onclick="showTab('redondeo')" class="tab-btn px-4 py-2 bg-white text-indigo-600 rounded-lg font-semibold shadow-md hover:bg-indigo-50">3. Redondeo</button>
            <button onclick="showTab('operaciones')" class="tab-btn px-4 py-2 bg-white text-indigo-600 rounded-lg font-semibold shadow-md hover:bg-indigo-50">4. Operaciones</button>
            <button onclick="showTab('potencias')" class="tab-btn px-4 py-2 bg-white text-indigo-600 rounded-lg font-semibold shadow-md hover:bg-indigo-50">5. Potencias de 10</button>
            <button onclick="showTab('fracciones')" class="tab-btn px-4 py-2 bg-white text-indigo-600 rounded-lg font-semibold shadow-md hover:bg-indigo-50">6. Paso a Fracci√≥n</button>
        </nav>

        <!-- Main Content Sections -->
        <main class="bg-white rounded-3xl shadow-xl p-6 min-h-[500px]">
            
            <!-- 1. Valor de Posici√≥n -->
            <section id="posicion" class="tab-content active">
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">El √Åbaco Decimal</h2>
                    <p class="text-gray-500">Identifica cada parte del n√∫mero decimal</p>
                </div>
                <div class="flex flex-col items-center">
                    <div id="posicion-number" class="text-6xl font-black text-indigo-600 tracking-widest mb-8">34.567</div>
                    <div class="grid grid-cols-2 md:grid-cols-5 gap-4 w-full">
                        <div class="bg-blue-50 p-4 rounded-xl text-center border-b-4 border-blue-400">
                            <span class="block text-sm font-bold text-blue-600">Decenas</span>
                            <span class="text-3xl font-bold">3</span>
                        </div>
                        <div class="bg-blue-50 p-4 rounded-xl text-center border-b-4 border-blue-400">
                            <span class="block text-sm font-bold text-blue-600">Unidades</span>
                            <span class="text-3xl font-bold">4</span>
                        </div>
                        <div class="bg-yellow-50 p-4 rounded-xl text-center border-b-4 border-yellow-400">
                            <span class="block text-sm font-bold text-yellow-600">D√©cimas</span>
                            <span class="text-3xl font-bold">5</span>
                        </div>
                        <div class="bg-yellow-50 p-4 rounded-xl text-center border-b-4 border-yellow-400">
                            <span class="block text-sm font-bold text-yellow-600">Cent√©simas</span>
                            <span class="text-3xl font-bold">6</span>
                        </div>
                        <div class="bg-yellow-50 p-4 rounded-xl text-center border-b-4 border-yellow-400">
                            <span class="block text-sm font-bold text-yellow-600">Mil√©simas</span>
                            <span class="text-3xl font-bold">7</span>
                        </div>
                    </div>
                    <div class="mt-8 p-6 bg-indigo-50 rounded-2xl w-full">
                        <p class="font-bold text-indigo-800 mb-2">Reto: Escribe la cifra que ocupa el lugar de <span id="pos-target">las cent√©simas</span> en el n√∫mero <span id="pos-number-display" class="text-indigo-600 text-lg">12.894</span></p>
                        <div class="flex gap-4">
                            <input type="number" id="pos-answer" class="flex-1 p-3 rounded-xl border-2 border-indigo-200 focus:border-indigo-500 outline-none text-center font-bold text-xl" placeholder="?">
                            <button onclick="checkPosicion()" class="bg-indigo-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-indigo-700 transition">Comprobar</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 2. Comparaci√≥n y Orden -->
            <section id="orden" class="tab-content">
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">El Duelo de Decimales</h2>
                    <p class="text-gray-500">¬øCu√°l es mayor? ¬°Cuidado con la longitud de las cifras!</p>
                </div>
                <div class="flex flex-col items-center gap-8">
                    <div class="flex items-center justify-around w-full max-w-md">
                        <div id="comp-n1" class="text-4xl font-bold text-gray-700">5.42</div>
                        <div class="flex flex-col gap-2">
                            <button onclick="checkComp('>')" class="bg-white border-2 border-indigo-500 text-indigo-600 w-12 h-12 rounded-full font-bold text-2xl hover:bg-indigo-500 hover:text-white transition">></button>
                            <button onclick="checkComp('<')" class="bg-white border-2 border-indigo-500 text-indigo-600 w-12 h-12 rounded-full font-bold text-2xl hover:bg-indigo-500 hover:text-white transition"><</button>
                            <button onclick="checkComp('=')" class="bg-white border-2 border-indigo-500 text-indigo-600 w-12 h-12 rounded-full font-bold text-2xl hover:bg-indigo-500 hover:text-white transition">=</button>
                        </div>
                        <div id="comp-n2" class="text-4xl font-bold text-gray-700">5.409</div>
                    </div>
                    <div class="bg-yellow-50 p-4 rounded-xl text-sm text-yellow-800 max-w-md">
                        <strong>üí° Truco:</strong> A√±ade ceros al final para que tengan la misma cantidad de cifras decimales antes de comparar. <br>Ejemplo: 5.420 es mayor que 5.409.
                    </div>
                </div>
            </section>

            <!-- 3. Redondeo -->
            <section id="redondeo" class="tab-content">
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">Precisi√≥n M√°xima</h2>
                    <p class="text-gray-500">Redondea a la unidad, d√©cima o cent√©sima</p>
                </div>
                <div class="max-w-md mx-auto space-y-6">
                    <div class="bg-indigo-600 text-white p-8 rounded-3xl text-center shadow-lg">
                        <span class="text-sm uppercase tracking-widest opacity-80">N√∫mero a redondear</span>
                        <div id="round-num" class="text-5xl font-black mt-2">12.678</div>
                    </div>
                    <div class="space-y-4">
                        <p class="font-bold text-center">Redondea a las <span id="round-target-unit" class="text-indigo-600">cent√©simas</span>:</p>
                        <div class="flex gap-4">
                            <input type="text" id="round-answer" class="flex-1 p-4 rounded-xl border-2 border-indigo-100 text-center text-2xl font-bold" placeholder="0.00">
                            <button onclick="checkRedondeo()" class="bg-indigo-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-indigo-700 transition">OK</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 4. Operaciones -->
            <section id="operaciones" class="tab-content">
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">Calculadora Mental</h2>
                    <p class="text-gray-500">Suma, resta, multiplica y divide</p>
                </div>
                <div class="grid md:grid-cols-2 gap-8 items-center">
                    <div class="bg-gray-50 p-6 rounded-3xl border-2 border-dashed border-gray-200">
                        <div id="op-display" class="text-4xl font-mono font-bold text-center py-10">
                            12.5 + 4.82
                        </div>
                    </div>
                    <div class="space-y-4">
                        <label class="block text-sm font-bold text-gray-600">TU RESULTADO:</label>
                        <input type="text" id="op-answer" class="w-full p-4 rounded-2xl border-2 border-indigo-200 text-3xl font-bold" placeholder="0.00">
                        <button onclick="checkOperacion()" class="w-full bg-indigo-600 text-white py-4 rounded-2xl font-bold text-xl hover:bg-indigo-700 shadow-lg transition">Verificar Operaci√≥n</button>
                        <div class="text-xs text-gray-400 italic">Nota: Usa el punto (.) para los decimales.</div>
                    </div>
                </div>
            </section>

            <!-- 5. Potencias de 10 -->
            <section id="potencias" class="tab-content">
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">Mueve la Coma</h2>
                    <p class="text-gray-500">Multiplicar y dividir por 10, 100, 1000...</p>
                </div>
                <div class="max-w-xl mx-auto space-y-8">
                    <div class="flex justify-center items-center gap-6">
                        <div id="pow-n1" class="text-4xl font-bold">4.5</div>
                        <div id="pow-op" class="text-3xl font-bold text-red-500">√ó</div>
                        <div id="pow-n2" class="text-4xl font-bold">100</div>
                    </div>
                    <div class="bg-indigo-50 p-8 rounded-3xl">
                        <input type="text" id="pow-answer" class="w-full p-4 rounded-2xl text-center text-4xl font-bold border-2 border-indigo-200" placeholder="?">
                        <button onclick="checkPotencia()" class="w-full mt-4 bg-indigo-600 text-white py-4 rounded-2xl font-bold text-xl hover:bg-indigo-700 transition">Lanzar!</button>
                    </div>
                </div>
            </section>

            <!-- 6. Fracciones -->
            <section id="fracciones" class="tab-content">
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">El Puente Fraccionario</h2>
                    <p class="text-gray-500">Convierte decimales exactos en fracciones decimales</p>
                </div>
                <div class="flex flex-col items-center gap-8">
                    <div id="frac-decimal" class="text-5xl font-black text-indigo-600">0.75</div>
                    <div class="flex items-center gap-4">
                        <div class="flex flex-col gap-2">
                            <input type="number" id="frac-num" class="w-24 p-3 border-2 border-gray-300 rounded-lg text-center font-bold" placeholder="Num">
                            <div class="h-1 bg-gray-800 w-full"></div>
                            <input type="number" id="frac-den" class="w-24 p-3 border-2 border-gray-300 rounded-lg text-center font-bold" placeholder="Den">
                        </div>
                        <button onclick="checkFraccion()" class="bg-indigo-600 text-white px-8 py-10 rounded-2xl font-bold hover:bg-indigo-700 transition shadow-lg">Convertir</button>
                    </div>
                </div>
            </section>

        </main>

        <!-- Notification area -->
        <div id="notification" class="fixed bottom-10 left-1/2 -translate-x-1/2 hidden px-8 py-4 rounded-full font-bold text-white shadow-2xl z-50">
            ¬°Correcto! +10 puntos
        </div>
    </div>

    <script>
        let score = 0;
        let currentLevel = "Aprendiz";
        const levels = ["Aprendiz", "Calculador", "Experto Decimal", "Maestro de las Comas"];

        // State variables for problems
        let state = {
            posicion: { target: 0, num: 0 },
            orden: { n1: 0, n2: 0 },
            redondeo: { num: 0, targetType: "" },
            operacion: { n1: 0, n2: 0, op: "", ans: 0 },
            potencia: { n1: 0, n2: 0, op: "", ans: 0 },
            fraccion: { decimal: 0, num: 0, den: 0 }
        };

        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => {
                b.classList.remove('bg-indigo-600', 'text-white');
                b.classList.add('bg-white', 'text-indigo-600');
            });

            document.getElementById(tabId).classList.add('active');
            const btn = event.target;
            btn.classList.remove('bg-white', 'text-indigo-600');
            btn.classList.add('bg-indigo-600', 'text-white');

            initModule(tabId);
        }

        function notify(msg, success = true) {
            const n = document.getElementById('notification');
            n.innerText = msg;
            n.className = `fixed bottom-10 left-1/2 -translate-x-1/2 px-8 py-4 rounded-full font-bold text-white shadow-2xl z-50 feedback-pop ${success ? 'bg-green-500' : 'bg-red-500'}`;
            n.classList.remove('hidden');
            setTimeout(() => n.classList.add('hidden'), 2500); // Increased time slightly for readability
        }

        function updateScore(points) {
            score += points;
            document.getElementById('score').innerText = score;
            
            let levelIdx = Math.floor(score / 100);
            if(levelIdx >= levels.length) levelIdx = levels.length - 1;
            currentLevel = levels[levelIdx];
            document.getElementById('level-name').innerText = currentLevel;
        }

        function initModule(id) {
            switch(id) {
                case 'posicion': genPosicion(); break;
                case 'orden': genOrden(); break;
                case 'redondeo': genRedondeo(); break;
                case 'operaciones': genOperacion(); break;
                case 'potencias': genPotencia(); break;
                case 'fracciones': genFraccion(); break;
            }
        }

        // --- MODULE GENERATORS & LOGIC ---

        function genPosicion() {
            // Generate a random number with 3 decimals
            const n = (Math.random() * 100).toFixed(3);
            state.posicion.num = n;
            
            // Determine available places based on the number size
            const parts = n.split('.');
            const intPart = parts[0];
            const availablePlaces = ["unidades", "d√©cimas", "cent√©simas", "mil√©simas"];
            
            // Only ask for Tens if there are tens (number >= 10)
            if (parseInt(intPart) >= 10) {
                availablePlaces.push("decenas");
            }

            state.posicion.targetPlace = availablePlaces[Math.floor(Math.random() * availablePlaces.length)];
            
            const labels = {
                "decenas": "las DECENAS",
                "unidades": "las UNIDADES",
                "d√©cimas": "las D√âCIMAS",
                "cent√©simas": "las CENT√âSIMAS",
                "mil√©simas": "las MIL√âSIMAS"
            };
            
            // Update UI
            document.getElementById('pos-number-display').innerText = n;
            document.querySelector('#pos-target').innerText = labels[state.posicion.targetPlace];
            
            // Update main display example (just visualization, static for concept)
            // Ideally this could dynamic too, but for now we keep the top example static or update it?
            // Let's leave the top example as a static reference for teaching, focusing the challenge below.
            
            document.getElementById('pos-answer').value = "";
            document.getElementById('pos-answer').focus();
        }

        function checkPosicion() {
            const ans = document.getElementById('pos-answer').value.trim();
            const nStr = state.posicion.num; // e.g., "12.894" or "5.420"
            const parts = nStr.split('.');
            const intPart = parts[0]; // "12" or "5"
            const decPart = parts[1]; // "894" or "420"

            let correctDigit = "";

            // Robust logic to find the digit
            switch(state.posicion.targetPlace) {
                case "decenas":
                    // Second digit from right in integer part
                    correctDigit = intPart.length >= 2 ? intPart[intPart.length - 2] : "0";
                    break;
                case "unidades":
                    // Last digit of integer part
                    correctDigit = intPart[intPart.length - 1];
                    break;
                case "d√©cimas":
                    // First digit of decimal part
                    correctDigit = decPart[0];
                    break;
                case "cent√©simas":
                    // Second digit of decimal part
                    correctDigit = decPart[1];
                    break;
                case "mil√©simas":
                    // Third digit of decimal part
                    correctDigit = decPart[2];
                    break;
            }

            if(ans === correctDigit) {
                notify("¬°Excelente! Has identificado la cifra correcta.");
                updateScore(10);
                genPosicion();
            } else {
                notify(`¬°Ups! En ${state.posicion.num}, las ${state.posicion.targetPlace} son el n√∫mero ${correctDigit}.`, false);
            }
        }

        function genOrden() {
            const base = (Math.random() * 10).toFixed(1);
            state.orden.n1 = (parseFloat(base) + Math.random() * 0.1).toFixed(3);
            state.orden.n2 = (parseFloat(base) + Math.random() * 0.1).toFixed(2);
            document.getElementById('comp-n1').innerText = state.orden.n1;
            document.getElementById('comp-n2').innerText = state.orden.n2;
        }

        function checkComp(symbol) {
            const v1 = parseFloat(state.orden.n1);
            const v2 = parseFloat(state.orden.n2);
            let correct = false;
            if(symbol === '>') correct = v1 > v2;
            if(symbol === '<') correct = v1 < v2;
            if(symbol === '=') correct = v1 === v2;

            if(correct) {
                notify("¬°Correcto! Dominas el orden decimal.");
                updateScore(15);
                genOrden();
            } else {
                notify("Error. Recuerda igualar el n√∫mero de cifras con ceros.", false);
            }
        }

        function genRedondeo() {
            state.redondeo.num = (Math.random() * 100).toFixed(3);
            const types = ["unidades", "d√©cimas", "cent√©simas"];
            state.redondeo.targetType = types[Math.floor(Math.random() * types.length)];
            document.getElementById('round-num').innerText = state.redondeo.num;
            document.getElementById('round-target-unit').innerText = state.redondeo.targetType;
            document.getElementById('round-answer').value = "";
        }

        function checkRedondeo() {
            const val = parseFloat(state.redondeo.num);
            let expected;
            if(state.redondeo.targetType === "unidades") expected = Math.round(val);
            if(state.redondeo.targetType === "d√©cimas") expected = Math.round(val * 10) / 10;
            if(state.redondeo.targetType === "cent√©simas") expected = Math.round(val * 100) / 100;

            const userAns = parseFloat(document.getElementById('round-answer').value.replace(',', '.'));
            if(userAns === expected) {
                notify("¬°Perfecto! Tienes mucha precisi√≥n.");
                updateScore(20);
                genRedondeo();
            } else {
                notify(`Incorrecto. El resultado era ${expected}`, false);
            }
        }

        function genOperacion() {
            const ops = ['+', '-', '*', '/'];
            const op = ops[Math.floor(Math.random() * ops.length)];
            let n1, n2, ans;

            if(op === '+') {
                n1 = (Math.random() * 50).toFixed(2);
                n2 = (Math.random() * 50).toFixed(2);
                ans = parseFloat(n1) + parseFloat(n2);
            } else if(op === '-') {
                n1 = (Math.random() * 100 + 50).toFixed(2);
                n2 = (Math.random() * 50).toFixed(2);
                ans = parseFloat(n1) - parseFloat(n2);
            } else if(op === '*') {
                n1 = (Math.random() * 10).toFixed(1);
                n2 = (Math.random() * 5).toFixed(1);
                ans = parseFloat(n1) * parseFloat(n2);
            } else {
                // Division simple para 1¬∫ eso
                n2 = [2, 4, 5, 10, 0.5, 0.1][Math.floor(Math.random() * 6)];
                n1 = (n2 * (Math.floor(Math.random() * 20) + 1)).toFixed(1);
                ans = parseFloat(n1) / n2;
            }

            state.operacion = { n1, n2, op, ans: ans.toFixed(2) };
            document.getElementById('op-display').innerText = `${n1} ${op === '*' ? '√ó' : op === '/' ? '√∑' : op} ${n2}`;
            document.getElementById('op-answer').value = "";
        }

        function checkOperacion() {
            const userAns = parseFloat(document.getElementById('op-answer').value.replace(',', '.')).toFixed(2);
            if(userAns === state.operacion.ans) {
                notify("¬°Operaci√≥n perfecta!");
                updateScore(25);
                genOperacion();
            } else {
                notify(`Casi, el resultado era ${state.operacion.ans}`, false);
            }
        }

        function genPotencia() {
            const n = (Math.random() * 500).toFixed(2);
            const powers = [10, 100, 1000, 0.1, 0.01];
            const p = powers[Math.floor(Math.random() * powers.length)];
            state.potencia.n1 = n;
            state.potencia.n2 = p;
            state.potencia.op = '√ó';
            state.potencia.ans = (n * p).toFixed(4);

            document.getElementById('pow-n1').innerText = n;
            document.getElementById('pow-op').innerText = '√ó';
            document.getElementById('pow-n2').innerText = p;
            document.getElementById('pow-answer').value = "";
        }

        function checkPotencia() {
            const userAns = parseFloat(document.getElementById('pow-answer').value.replace(',', '.'));
            const correct = Math.abs(userAns - parseFloat(state.potencia.ans)) < 0.0001;
            if(correct) {
                notify("¬°Esa coma vuela! Muy bien.");
                updateScore(15);
                genPotencia();
            } else {
                notify("Revisa hacia d√≥nde mueves la coma.", false);
            }
        }

        function genFraccion() {
            const decimals = [0.5, 0.25, 0.75, 0.2, 0.4, 0.8, 0.125, 1.5, 0.1, 0.01];
            const d = decimals[Math.floor(Math.random() * decimals.length)];
            state.fraccion.decimal = d;
            document.getElementById('frac-decimal').innerText = d;
            document.getElementById('frac-num').value = "";
            document.getElementById('frac-den').value = "";
        }

        function checkFraccion() {
            const n = parseInt(document.getElementById('frac-num').value);
            const d = parseInt(document.getElementById('frac-den').value);
            if(n / d === state.fraccion.decimal) {
                notify("¬°Fracci√≥n equivalente encontrada!");
                updateScore(30);
                genFraccion();
            } else {
                notify("Esa fracci√≥n no da el decimal pedido.", false);
            }
        }

        // Initialize first module
        window.onload = () => {
            initModule('posicion');
        };
    </script>
</body>
</html>
