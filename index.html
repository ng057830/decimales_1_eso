<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Convertidor Decimal ↔ Fracción (1º ESO)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap');
    body { font-family: 'Outfit', sans-serif; background:#f0f4f8; }
    .tab-content { display:none; }
    .tab-content.active { display:block; }
    .feedback-pop { animation: pop .25s ease-out; }
    @keyframes pop { from{transform:scale(.96);opacity:.2} to{transform:scale(1);opacity:1} }
    code.kbd { background:#eef2ff; padding:.15rem .4rem; border-radius:.5rem; font-weight:700; }
  </style>
</head>
<body class="p-4 md:p-8">
  <div class="max-w-4xl mx-auto">
    <header class="text-center mb-8">
      <h1 class="text-4xl font-extrabold text-indigo-800 mb-2">Decimal ↔ Fracción</h1>
      <p class="text-gray-600">Guía paso a paso (exactos y periódicos)</p>
      <div class="mt-4 inline-flex items-center gap-3 bg-white px-5 py-3 rounded-2xl shadow-sm">
        <span class="text-xs uppercase font-bold text-gray-400">Formato periódico</span>
        <span class="text-sm font-bold text-indigo-700">
          <span class="mr-2"><code class="kbd">0.(3)</code></span>
          <span class="mr-2"><code class="kbd">1.2(45)</code></span>
          <span><code class="kbd">-0.1(6)</code></span>
        </span>
      </div>
    </header>

    <nav class="flex flex-wrap justify-center gap-2 mb-6">
      <button id="btn-dec2frac" class="tab-btn px-4 py-2 bg-indigo-600 text-white rounded-lg font-semibold shadow-md"
              onclick="showTab('dec2frac', this)">
        Decimal → Fracción
      </button>
      <button id="btn-frac2dec" class="tab-btn px-4 py-2 bg-white text-indigo-600 rounded-lg font-semibold shadow-md hover:bg-indigo-50"
              onclick="showTab('frac2dec', this)">
        Fracción → Decimal
      </button>
    </nav>

    <main class="bg-white rounded-3xl shadow-xl p-6 md:p-8 min-h-[460px]">

      <!-- DECIMAL -> FRAC -->
      <section id="dec2frac" class="tab-content active">
        <div class="mb-6">
          <h2 class="text-2xl font-bold text-gray-800">Decimal → Fracción</h2>
          <p class="text-gray-500">Admite exactos y periódicos (con paréntesis).</p>
        </div>

        <div class="grid md:grid-cols-2 gap-6 items-start">
          <div class="bg-indigo-50 rounded-2xl p-5">
            <label class="block text-sm font-bold text-indigo-900 mb-2">Escribe el decimal</label>
            <input id="dec-input" type="text"
                   class="w-full p-4 rounded-2xl border-2 border-indigo-200 text-xl font-bold outline-none focus:border-indigo-500"
                   placeholder="Ej: 12.375   |   0.(3)   |   1.2(45)" />
            <div class="flex gap-3 mt-4">
              <button onclick="convertDecToFrac()"
                      class="flex-1 bg-indigo-600 text-white py-3 rounded-2xl font-bold hover:bg-indigo-700 transition">
                Convertir
              </button>
              <button onclick="exampleDec()"
                      class="bg-white border-2 border-indigo-400 text-indigo-700 px-5 py-3 rounded-2xl font-bold hover:bg-indigo-100 transition">
                Ejemplo
              </button>
            </div>

            <div class="mt-4 text-xs text-indigo-900/80">
              <p class="font-bold mb-1">Ejemplos rápidos:</p>
              <ul class="list-disc pl-5 space-y-1">
                <li><code class="kbd">0.75</code> → 3/4</li>
                <li><code class="kbd">0.(6)</code> → 2/3</li>
                <li><code class="kbd">1.2(45)</code> → 41/33</li>
              </ul>
            </div>
          </div>

          <div class="bg-gray-50 rounded-2xl p-5 border border-gray-200">
            <div class="flex items-center justify-between gap-3">
              <h3 class="text-lg font-extrabold text-gray-800">Resultado</h3>
              <button onclick="copyText('dec2frac-out')"
                      class="text-sm font-bold text-indigo-700 hover:text-indigo-900">
                Copiar
              </button>
            </div>
            <div id="dec2frac-out" class="mt-3 text-2xl font-black text-indigo-700">—</div>

            <h4 class="mt-6 text-sm font-extrabold text-gray-700 uppercase tracking-wider">Paso a paso</h4>
            <div id="dec2frac-steps" class="mt-2 text-sm text-gray-700 leading-relaxed whitespace-pre-line">Escribe un decimal y pulsa “Convertir”.</div>

            <div id="dec2frac-error" class="hidden mt-4 px-4 py-3 rounded-xl bg-red-50 text-red-700 font-bold"></div>
          </div>
        </div>
      </section>

      <!-- FRAC -> DEC -->
      <section id="frac2dec" class="tab-content">
        <div class="mb-6">
          <h2 class="text-2xl font-bold text-gray-800">Fracción → Decimal</h2>
          <p class="text-gray-500">Te muestra si el resultado es exacto o periódico (con paréntesis).</p>
        </div>

        <div class="grid md:grid-cols-2 gap-6 items-start">
          <div class="bg-indigo-50 rounded-2xl p-5">
            <label class="block text-sm font-bold text-indigo-900 mb-2">Escribe la fracción</label>

            <div class="flex gap-3 items-center">
              <input id="frac-num" type="text"
                     class="w-full p-4 rounded-2xl border-2 border-indigo-200 text-xl font-bold outline-none focus:border-indigo-500 text-center"
                     placeholder="Numerador (ej: 41)" />
              <span class="text-3xl font-black text-indigo-700">/</span>
              <input id="frac-den" type="text"
                     class="w-full p-4 rounded-2xl border-2 border-indigo-200 text-xl font-bold outline-none focus:border-indigo-500 text-center"
                     placeholder="Denominador (ej: 33)" />
            </div>

            <div class="flex gap-3 mt-4">
              <button onclick="convertFracToDec()"
                      class="flex-1 bg-indigo-600 text-white py-3 rounded-2xl font-bold hover:bg-indigo-700 transition">
                Convertir
              </button>
              <button onclick="exampleFrac()"
                      class="bg-white border-2 border-indigo-400 text-indigo-700 px-5 py-3 rounded-2xl font-bold hover:bg-indigo-100 transition">
                Ejemplo
              </button>
            </div>

            <div class="mt-4 text-xs text-indigo-900/80">
              <p class="font-bold mb-1">Ejemplos rápidos:</p>
              <ul class="list-disc pl-5 space-y-1">
                <li>3/8 → 0.375</li>
                <li>2/3 → 0.(6)</li>
                <li>41/33 → 1.2(42)</li>
              </ul>
            </div>
          </div>

          <div class="bg-gray-50 rounded-2xl p-5 border border-gray-200">
            <div class="flex items-center justify-between gap-3">
              <h3 class="text-lg font-extrabold text-gray-800">Resultado</h3>
              <button onclick="copyText('frac2dec-out')"
                      class="text-sm font-bold text-indigo-700 hover:text-indigo-900">
                Copiar
              </button>
            </div>
            <div id="frac2dec-out" class="mt-3 text-2xl font-black text-indigo-700">—</div>

            <h4 class="mt-6 text-sm font-extrabold text-gray-700 uppercase tracking-wider">Paso a paso</h4>
            <div id="frac2dec-steps" class="mt-2 text-sm text-gray-700 leading-relaxed whitespace-pre-line">Escribe numerador y denominador, y pulsa “Convertir”.</div>

            <div id="frac2dec-error" class="hidden mt-4 px-4 py-3 rounded-xl bg-red-50 text-red-700 font-bold"></div>
          </div>
        </div>
      </section>

    </main>

    <div id="toast" class="fixed bottom-8 left-1/2 -translate-x-1/2 hidden px-6 py-3 rounded-full font-bold text-white shadow-2xl z-50 feedback-pop bg-indigo-700">
      Copiado ✅
    </div>
  </div>

<script>
  // ---------- UI ----------
  function showTab(tabId, btn){
    document.querySelectorAll('.tab-content').forEach(s => s.classList.remove('active'));
    document.querySelectorAll('.tab-btn').forEach(b=>{
      b.classList.remove('bg-indigo-600','text-white');
      b.classList.add('bg-white','text-indigo-600');
    });
    document.getElementById(tabId).classList.add('active');
    btn.classList.remove('bg-white','text-indigo-600');
    btn.classList.add('bg-indigo-600','text-white');

    // limpia errores
    hideError('dec2frac-error');
    hideError('frac2dec-error');
  }

  function toast(msg="Copiado ✅"){
    const t=document.getElementById('toast');
    t.textContent=msg;
    t.classList.remove('hidden');
    setTimeout(()=>t.classList.add('hidden'),1200);
  }

  async function copyText(id){
    const el=document.getElementById(id);
    const txt=el.textContent.trim();
    if(!txt || txt==="—") return;
    try { await navigator.clipboard.writeText(txt); toast(); }
    catch { toast("No se pudo copiar"); }
  }

  function showError(id,msg){
    const e=document.getElementById(id);
    e.textContent=msg;
    e.classList.remove('hidden');
  }
  function hideError(id){
    const e=document.getElementById(id);
    e.classList.add('hidden');
    e.textContent="";
  }

  function exampleDec(){
    const ex=["0.75","0.(6)","1.2(45)","12.375","-0.1(6)"];
    document.getElementById('dec-input').value = ex[Math.floor(Math.random()*ex.length)];
    convertDecToFrac();
  }
  function exampleFrac(){
    const ex=[[3,8],[2,3],[41,33],[7,20],[-5,6]];
    const [a,b]=ex[Math.floor(Math.random()*ex.length)];
    document.getElementById('frac-num').value=a;
    document.getElementById('frac-den').value=b;
    convertFracToDec();
  }

  // ---------- Math helpers ----------
  function gcd(a,b){
    a=Math.abs(a); b=Math.abs(b);
    while(b!==0){ const t=a%b; a=b; b=t; }
    return a;
  }
  function reduceFrac(num, den){
    if(den===0) throw new Error("Denominador 0 no está permitido.");
    if(num===0) return {num:0, den:1};
    const sign = (num*den<0) ? -1 : 1;
    num=Math.abs(num); den=Math.abs(den);
    const g=gcd(num,den);
    return {num: sign*(num/g), den: den/g};
  }

  // Parse decimal:
  // - finite: 12.375
  // - repeating: 1.2(45)  or 0.(3)
  function parseDecimalString(s){
    s = (s||"").trim();
    if(!s) throw new Error("Escribe un número decimal.");
    s = s.replace(',', '.');

    const m = s.match(/^([+-])?(\d+)(?:\.(\d*))?(?:\((\d+)\))?$/);
    if(!m) throw new Error("Formato no válido. Usa por ejemplo 12.375 o 1.2(45) o 0.(3).");

    const sign = m[1]==="-" ? -1 : 1;
    const intPart = m[2];                 // "1"
    const nonRep = (m[3] ?? "");          // "2"
    const rep = (m[4] ?? "");             // "45" or ""

    // if there's parentheses but empty -> invalid already by regex
    return {sign, intPart, nonRep, rep};
  }

  // Decimal -> fraction
  function decimalToFractionSteps(s){
    const {sign, intPart, nonRep, rep} = parseDecimalString(s);

    const I = BigInt(intPart);
    const m = nonRep.length;
    const k = rep.length;

    let steps = [];
    steps.push(`Entrada: ${s.replace(',', '.')}`);

    if(k===0){
      // exact decimal
      const A = BigInt(nonRep || "0");
      const tenPowM = BigInt(10) ** BigInt(m);

      // value = sign * (I + A/10^m) = sign * (I*10^m + A)/10^m
      const num = (I * tenPowM + A) * BigInt(sign);
      const den = tenPowM;

      steps.push(`Decimal exacto (sin período).`);
      steps.push(`Se escribe como fracción con denominador 10^${m}:`);
      steps.push(`  ${intPart}.${nonRep || "0"} = (${intPart}·10^${m} + ${nonRep || "0"}) / 10^${m}`);
      return {num, den, steps};
    }

    // repeating decimal
    // x = I + nonRep/10^m + rep / (10^m (10^k - 1))
    const A = BigInt(nonRep || "0");
    const B = BigInt(rep);

    const tenPowM = BigInt(10) ** BigInt(m);
    const tenPowK = BigInt(10) ** BigInt(k);

    const repDen = (tenPowK - BigInt(1));                 // 10^k - 1
    // numerator for fractional part: A*(10^k - 1) + B
    const fracNum = A * repDen + B;
    const fracDen = tenPowM * repDen;

    // total num/den: I + fracNum/fracDen = (I*fracDen + fracNum)/fracDen
    const num = (I * fracDen + fracNum) * BigInt(sign);
    const den = fracDen;

    steps.push(`Decimal periódico detectado: parte no periódica = "${nonRep || "∅"}", período = "${rep}".`);
    steps.push(`Idea: eliminar la coma y luego restar para borrar el período.`);
    steps.push(`Método directo con potencias de 10:`);
    steps.push(`  Sea x = ${intPart}.${nonRep}(${rep})`);
    steps.push(`  m = ${m} (cifras no periódicas), k = ${k} (cifras del período)`);
    steps.push(`  Fracción de la parte decimal = (A·(10^k−1) + B) / (10^m·(10^k−1))`);
    steps.push(`  donde A = ${nonRep || "0"} y B = ${rep}`);
    steps.push(`  Entonces x = I + esa fracción, con I = ${intPart}`);

    return {num, den, steps};
  }

  function bigIntToReducedString(numBI, denBI){
    // reduce using BigInt gcd
    let n = numBI;
    let d = denBI;
    if(d===BigInt(0)) throw new Error("Denominador 0 no está permitido.");

    if(n===BigInt(0)) return {str:"0/1", n:BigInt(0), d:BigInt(1)};

    const sign = (n<0n) ? -1n : 1n;
    n = n*sign;

    // gcd for BigInt
    const bgcd = (a,b)=>{ a=a<0n?-a:a; b=b<0n?-b:b; while(b!==0n){ const t=a%b; a=b; b=t; } return a; };
    const g = bgcd(n,d);
    n = n/g; d = d/g;
    n = n*sign;

    return {str:`${n.toString()}/${d.toString()}`, n, d};
  }

  function convertDecToFrac(){
    hideError('dec2frac-error');
    const input = document.getElementById('dec-input').value;

    try{
      const {num, den, steps} = decimalToFractionSteps(input);
      const red = bigIntToReducedString(num, den);

      document.getElementById('dec2frac-out').textContent = red.str;

      // Add reduction step if changed
      let extra = [];
      extra.push(`\nSimplificación: se reduce dividiendo entre el MCD del numerador y el denominador.`);
      extra.push(`Resultado final: ${red.str}`);

      document.getElementById('dec2frac-steps').textContent = steps.join('\n') + extra.join('\n');
    }catch(err){
      document.getElementById('dec2frac-out').textContent = "—";
      document.getElementById('dec2frac-steps').textContent = "Revisa el formato e inténtalo de nuevo.";
      showError('dec2frac-error', err.message || "Error.");
    }
  }

  // Fraction -> decimal (detect repeating via remainders)
  function fractionToDecimalWithPeriod(n, d){
    if(d===0) throw new Error("Denominador 0 no está permitido.");

    const sign = (n*d<0) ? "-" : "";
    n = Math.abs(n); d = Math.abs(d);

    const integerPart = Math.floor(n / d);
    let rem = n % d;

    if(rem===0){
      return {dec: sign + integerPart.toString(), steps:[
        `División: ${sign || ""}${n}/${d}`,
        `Como el resto es 0, el decimal es exacto.`,
        `Resultado: ${sign}${integerPart}`
      ]};
    }

    // long division with remainder map
    const seen = new Map(); // rem -> position
    let digits = [];
    let pos = 0;
    while(rem !== 0 && !seen.has(rem)){
      seen.set(rem, pos);
      rem *= 10;
      const digit = Math.floor(rem / d);
      digits.push(digit);
      rem = rem % d;
      pos++;
      // safety to avoid infinite in UI due to huge loops (still finite because repeats)
      if(pos > 5000) throw new Error("Período demasiado largo para mostrar.");
    }

    if(rem===0){
      // exact
      const dec = sign + integerPart + "." + digits.join("");
      return {
        dec,
        steps:[
          `División: ${sign || ""}${n}/${d}`,
          `El resto llega a 0 ⇒ decimal exacto.`,
          `Parte entera: ${integerPart}`,
          `Cifras decimales: ${digits.join("")}`,
          `Resultado: ${dec}`
        ]
      };
    }

    // repeating
    const start = seen.get(rem);
    const nonRep = digits.slice(0, start).join("");
    const rep = digits.slice(start).join("");
    const dec = sign + integerPart + "." + (nonRep || "") + "(" + rep + ")";

    return {
      dec,
      steps:[
        `División: ${sign || ""}${n}/${d}`,
        `Se guardan los restos: cuando un resto se repite, empieza el período.`,
        `Parte entera: ${integerPart}`,
        `Parte no periódica: ${nonRep || "∅"}`,
        `Período: ${rep}`,
        `Resultado: ${dec}`
      ]
    };
  }

  function convertFracToDec(){
    hideError('frac2dec-error');
    const aStr = (document.getElementById('frac-num').value || "").trim();
    const bStr = (document.getElementById('frac-den').value || "").trim();

    try{
      if(!aStr || !bStr) throw new Error("Escribe numerador y denominador.");
      if(!/^[+-]?\d+$/.test(aStr) || !/^[+-]?\d+$/.test(bStr))
        throw new Error("Usa enteros (sin decimales) en numerador y denominador.");

      let a = parseInt(aStr,10);
      let b = parseInt(bStr,10);

      // reduce fraction first
      const red = reduceFrac(a,b);
      a = red.num; b = red.den;

      const out = fractionToDecimalWithPeriod(a,b);

      document.getElementById('frac2dec-out').textContent = out.dec;

      const stepBlock = [
        `Fracción simplificada: ${a}/${b}`,
        ...out.steps
      ].join('\n');

      document.getElementById('frac2dec-steps').textContent = stepBlock;

    }catch(err){
      document.getElementById('frac2dec-out').textContent = "—";
      document.getElementById('frac2dec-steps').textContent = "Revisa los datos e inténtalo de nuevo.";
      showError('frac2dec-error', err.message || "Error.");
    }
  }

  // Init
  window.onload = () => {
    // ready
  };
</script>
</body>
</html>
